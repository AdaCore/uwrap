template w_Entity {
    var name : text;
}

var entity_map : map (string, object);

template my_out extends standard.out {}

match Entity ("A(?<a>.+)") {
   match not test.entity_map.element ("\e<a>") {
      pick test weave (entity_map => @.insert ("\e<a>", new (w_Entity (name => "[\e<a>]"))));
      pick test wrap my_out (@ & "RESULT: " & lambda (acc: test.entity_map(v: true).fold ("", acc & v.name & " ")));
   }
}
